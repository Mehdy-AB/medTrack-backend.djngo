Postman Testing Guide - CORE-SERVICE
üéØ Setup (No Auth/Profile Services Needed)
Since you don't have AUTH-SERVICE and PROFILE-SERVICE running, we'll:

Insert test data directly into the database
Test endpoints using Postman
Skip JWT authentication (set AllowAny permissions)
Step 1: Insert Test Data in Database
Connect to PostgreSQL
# From your project directory
docker-compose exec postgres psql -U postgres -d core_db
Run These SQL Commands:
-- Create test offers
INSERT INTO "core"."offers" (
    id, title, description, service_id, establishment_id, created_by,
    period_start, period_end, available_slots, status, metadata, created_at, updated_at
) VALUES
(
    'aaaaaaaa-1111-1111-1111-111111111111',
    'Cardiology Internship - City Hospital',
    'Full-time internship in cardiology department',
    'bbbbbbbb-2222-2222-2222-222222222222', -- service_id
    'cccccccc-3333-3333-3333-333333333333', -- establishment_id
    'dddddddd-4444-4444-4444-444444444444', -- created_by (encadrant)
    '2024-01-01',
    '2024-06-30',
    5,
    'published',
    '{}',
    NOW(),
    NOW()
),
(
    'aaaaaaaa-1111-1111-1111-111111111112',
    'Neurology Research Position',
    'Research internship in neurology',
    'bbbbbbbb-2222-2222-2222-222222222223',
    'cccccccc-3333-3333-3333-333333333333',
    'dddddddd-4444-4444-4444-444444444444',
    '2024-02-01',
    '2024-08-31',
    3,
    'draft',
    '{}',
    NOW(),
    NOW()
),
(
    'aaaaaaaa-1111-1111-1111-111111111113',
    'Pediatrics Summer Internship',
    'Summer position in pediatrics',
    'bbbbbbbb-2222-2222-2222-222222222224',
    'cccccccc-3333-3333-3333-333333333334',
    'dddddddd-4444-4444-4444-444444444445',
    '2024-06-01',
    '2024-08-31',
    2,
    'published',
    '{}',
    NOW(),
    NOW()
);
-- Create test applications
INSERT INTO "core"."applications" (
    id, offer_id, student_id, submitted_at, status,
    decision_at, decision_by, notes, metadata
) VALUES
(
    'eeeeeeee-5555-5555-5555-555555555551',
    'aaaaaaaa-1111-1111-1111-111111111111', -- Cardiology offer
    'ffffffff-6666-6666-6666-666666666661', -- student 1
    NOW(),
    'submitted',
    NULL,
    NULL,
    NULL,
    '{"motivation": "I love cardiology!"}'
),
(
    'eeeeeeee-5555-5555-5555-555555555552',
    'aaaaaaaa-1111-1111-1111-111111111111', -- Cardiology offer
    'ffffffff-6666-6666-6666-666666666662', -- student 2
    NOW(),
    'accepted',
    NOW(),
    'dddddddd-4444-4444-4444-444444444444',
    'Great candidate!',
    '{"motivation": "Cardiology is my passion"}'
),
(
    'eeeeeeee-5555-5555-5555-555555555553',
    'aaaaaaaa-1111-1111-1111-111111111113', -- Pediatrics offer
    'ffffffff-6666-6666-6666-666666666663', -- student 3
    NOW(),
    'rejected',
    NOW(),
    'dddddddd-4444-4444-4444-444444444444',
    'Not enough experience',
    '{"motivation": "I want to work with children"}'
);
-- Create test affectations
INSERT INTO "core"."affectations" (
    id, application_id, student_id, offer_id, assigned_at, metadata
) VALUES
(
    'gggggggg-7777-7777-7777-777777777771',
    'eeeeeeee-5555-5555-5555-555555555552', -- accepted application
    'ffffffff-6666-6666-6666-666666666662', -- student 2
    'aaaaaaaa-1111-1111-1111-111111111111', -- Cardiology offer
    NOW(),
    '{}'
);
-- Verify data
SELECT COUNT(*) as total_offers FROM "core"."offers";
SELECT COUNT(*) as total_applications FROM "core"."applications";
SELECT COUNT(*) as total_affectations FROM "core"."affectations";
You should see:

total_offers 
--------------
           3
 total_applications 
--------------------
                 3
 total_affectations 
--------------------
                 1
Type \q to exit psql.

Step 2: Postman Collection Setup
Base URL
http://localhost/core
Create Environment Variables
Open Postman
Click "Environments" ‚Üí "+" Create new
Name it "CORE-SERVICE Local"
Add variables:
Variable	Initial Value
base_url	http://localhost/core
offer_id
aaaaaaaa-1111-1111-1111-111111111111
app_id	eeeeeeee-5555-5555-5555-555555555551
aff_id	gggggggg-7777-7777-7777-777777777771
üìã Postman Requests
1. Health Check
Method: GET
URL: {{base_url}}/../health
Expected: 200 OK

{
  "status": "ok"
}
2. List All Offers
Method: GET
URL: {{base_url}}/offers/
Expected: 200 OK

Should return 3 offers.

3. List Offers with Filters
Method: GET
URL: {{base_url}}/offers/?status=published&per_page=5
Expected: 200 OK

Should return 2 published offers (Cardiology and Pediatrics).

4. Search Offers
Method: GET
URL: {{base_url}}/offers/?search=cardio
Expected: 200 OK

Should return "Cardiology Internship".

5. Get Offer Details
Method: GET
URL: {{base_url}}/offers/{{offer_id}}
Expected: 200 OK

Note: 
service
, 
establishment
, and 
created_by_encadrant
 will be null because PROFILE-SERVICE and AUTH-SERVICE aren't running. This is OK!

{
  "id": "aaaaaaaa-1111-1111-1111-111111111111",
  "title": "Cardiology Internship - City Hospital",
  "service_id": "bbbbbbbb-2222-2222-2222-222222222222",
  "available_slots": 5,
  "status": "published",
  "service": null,
  "created_by_encadrant": null,
  "application_count": 2,
  "remaining_slots": 4
}
6. Create New Offer
Method: POST
URL: {{base_url}}/offers/
Headers:

Content-Type: application/json
Body (raw JSON):

{
  "title": "Emergency Medicine Internship",
  "description": "Fast-paced ER internship",
  "service_id": "bbbbbbbb-2222-2222-2222-222222222225",
  "establishment_id": "cccccccc-3333-3333-3333-333333333335",
  "period_start": "2024-03-01",
  "period_end": "2024-09-30",
  "available_slots": 4,
  "status": "published"
}
Expected: 201 Created

Save the returned 
id
 for next tests!

7. Update Offer
Method: PATCH
URL: {{base_url}}/offers/{{offer_id}}
Headers:

Content-Type: application/json
Body (raw JSON):

{
  "title": "Cardiology Internship - UPDATED",
  "available_slots": 8
}
Expected: 200 OK

8. Update Offer Status
Method: PATCH
URL: {{base_url}}/offers/{{offer_id}}/status
Headers:

Content-Type: application/json
Body (raw JSON):

{
  "status": "closed"
}
Expected: 200 OK

9. List Applications for Offer
Method: GET
URL: {{base_url}}/offers/{{offer_id}}/applications
Expected: 200 OK

Should return 2 applications for Cardiology offer.

10. List All Applications
Method: GET
URL: {{base_url}}/applications/
Expected: 200 OK

Should return all 3 applications.

11. Filter Applications by Status
Method: GET
URL: {{base_url}}/applications/?status=submitted
Expected: 200 OK

Should return 1 submitted application.

12. Get Application Details
Method: GET
URL: {{base_url}}/applications/{{app_id}}
Expected: 200 OK

Note: 
student
 will be null (no PROFILE-SERVICE).

{
  "id": "eeeeeeee-5555-5555-5555-555555555551",
  "offer_id": "aaaaaaaa-1111-1111-1111-111111111111",
  "student_id": "ffffffff-6666-6666-6666-666666666661",
  "status": "submitted",
  "offer": {
    "id": "aaaaaaaa-1111-1111-1111-111111111111",
    "title": "Cardiology Internship - City Hospital",
    "period_start": "2024-01-01",
    "period_end": "2024-06-30"
  },
  "student": null,
  "decision_by_encadrant": null
}
13. Create Application
Method: POST
URL: {{base_url}}/applications/
Headers:

Content-Type: application/json
Body (raw JSON):

{
  "offer_id": "aaaaaaaa-1111-1111-1111-111111111113",
  "motivation": "I want to learn pediatrics!"
}
Expected: 201 Created

Note: student_id will be null (no JWT). You can manually set it in the database later if needed.

14. Update Application
Method: PATCH
URL: {{base_url}}/applications/{{app_id}}
Headers:

Content-Type: application/json
Body (raw JSON):

{
  "motivation": "Updated motivation - I REALLY want this internship!"
}
Expected: 200 OK

15. Accept Application
Method: PATCH
URL: {{base_url}}/applications/{{app_id}}/status
Headers:

Content-Type: application/json
Body (raw JSON):

{
  "status": "accepted",
  "notes": "Excellent application!"
}
Expected: 200 OK

What happens:

Application status ‚Üí "accepted"
Affectation is created automatically
RabbitMQ event published (if RabbitMQ is running)
16. Reject Application
Create a new application first, then:

Method: PATCH
URL: {{base_url}}/applications/{new_app_id}/status
Headers:

Content-Type: application/json
Body (raw JSON):

{
  "status": "rejected",
  "notes": "Not enough experience for this position"
}
Expected: 200 OK

17. Cancel Application (Delete)
Method: DELETE
URL: {{base_url}}/applications/{{app_id}}
Expected: 200 OK

Note: This sets status to "cancelled", doesn't delete.

18. List All Affectations
Method: GET
URL: {{base_url}}/affectations/
Expected: 200 OK

Should return at least 1 affectation.

19. Get Affectation Details
Method: GET
URL: {{base_url}}/affectations/{{aff_id}}
Expected: 200 OK

Note: offer.service and 
student
 will be null.

20. Get Student's Affectations
Method: GET
URL: {{base_url}}/affectations/by-student/ffffffff-6666-6666-6666-666666666662
Expected: 200 OK

Should return 1 affectation for student 2.

21. Create Affectation Manually
Method: POST
URL: {{base_url}}/affectations/
Headers:

Content-Type: application/json
Body (raw JSON):

{
  "application_id": "eeeeeeee-5555-5555-5555-555555555551",
  "student_id": "ffffffff-6666-6666-6666-666666666661",
  "offer_id": "aaaaaaaa-1111-1111-1111-111111111111"
}
Expected: 201 Created

22. Delete Affectation
Method: DELETE
URL: {{base_url}}/affectations/{{aff_id}}
Expected: 200 OK

{
  "success": true,
  "message": "Affectation deleted successfully"
}
üéØ Complete Testing Workflow
Test Scenario: Full Internship Application Flow
List published offers ‚Üí GET /offers/?status=published
View offer details ‚Üí GET /offers/{id}
Student applies ‚Üí POST /applications/ with 
offer_id
View application ‚Üí GET /applications/{id}
Admin accepts ‚Üí PATCH /applications/{id}/status with status=accepted
Check affectation created ‚Üí GET /affectations/
View student's affectations ‚Üí GET /affectations/by-student/{student_id}
üìä Quick Reference - All Endpoints
#	Method	Endpoint	Purpose
1	GET	/offers/	List offers
2	POST	/offers/	Create offer
3	GET	/offers/{id}	Get offer details
4	PATCH	/offers/{id}	Update offer
5	DELETE	/offers/{id}	Delete offer
6	PATCH	/offers/{id}/status	Update status
7	GET	/offers/{id}/applications	List applications
8	GET	/applications/	List applications
9	POST	/applications/	Create application
10	GET	/applications/{id}	Get application
11	PATCH	/applications/{id}	Update application
12	DELETE	/applications/{id}	Cancel application
13	PATCH	/applications/{id}/status	Accept/Reject
14	GET	/affectations/	List affectations
15	POST	/affectations/	Create affectation
16	GET	/affectations/{id}	Get affectation
17	DELETE	/affectations/{id}	Delete affectation
18	GET	/affectations/by-student/{id}	Student affectations
‚úÖ Testing Checklist
 Insert test data via SQL
 Create Postman environment
 Test health endpoint
 List offers (should see 3)
 Get offer details
 Create new offer
 Update offer
 Change offer status
 List applications
 Create application
 Accept application
 Verify affectation created
 Test all filters (status, search, pagination)
 Test error cases (invalid IDs, missing fields)
üêõ Expected Limitations (Without Other Services)
What WON'T work:

‚ùå 
service
, 
establishment
, 
created_by_encadrant
 in offer details ‚Üí will be null
‚ùå 
student
 details in application ‚Üí will be null
‚ùå JWT authentication ‚Üí disabled for testing
What WILL work:

‚úÖ All CRUD operations (Create, Read, Update, Delete)
‚úÖ Filtering and pagination
‚úÖ Status updates
‚úÖ Auto-creation of affectations
‚úÖ Application count and remaining slots calculation
‚úÖ RabbitMQ events (if RabbitMQ container is running)
This is perfect for testing the core functionality!

